<!doctype html> <html class="no-js" lang="ja"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>仕事でよく使うWindowsバッチファイルのあれこれ</title> <link rel="stylesheet" href="https://moni360.github.io/assets/css/styles_feeling_responsive.css"> <script src="https://moni360.github.io/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }); </script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic|Volkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="google-site-verification" content="" /> <meta name="msvalidate.01" content="" /> <meta name="description" content="怪しい記事ではありません。よく使うバッチの書き方など。"/> <link rel="author" href=""/> <link rel="icon" sizes="32x32" href="https://moni360.github.io/assets/img/favicon-32.png"> <link rel="icon" sizes="192x192" href="https://moni360.github.io/assets/img/touch-icon-192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://moni360.github.io/assets/img/touch-icon-180.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://moni360.github.io/assets/img/touch-icon-152.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://moni360.github.io/assets/img/touch-icon-144.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://moni360.github.io/assets/img/touch-icon-120.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://moni360.github.io/assets/img/touch-icon-114.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://moni360.github.io/assets/img/touch-icon-76.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://moni360.github.io/assets/img/touch-icon-72.png"> <link rel="apple-touch-icon-precomposed" href="https://moni360.github.io/assets/img/touch-icon-57.png"> <meta name="msapplication-TileImage" content="https://moni360.github.io/assets/img/touch-icon-144.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="" /> <meta property="og:type" content="website" /> <meta property="og:title" content="仕事でよく使うWindowsバッチファイルのあれこれ" /> <meta property="og:description" content="Arduino, Raspberry pi, FPGA, Python, Androidなど趣くままに色々なことを"/> <meta property="og:url" content="https://moni360.github.io//blog/2015/08/windows-bat-memo/" /> <meta property="og:site_name" content="Moni blog" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="https://moni360.github.io/humans.txt" /> </head> <body id="top-of-page" class="post"> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="https://moni360.github.io" class="icon-tree"> Moni blog</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="left"> <li><a href="https://moni360.github.io/">Home</a></li> <li class="divider"></li> <li><a href="https://moni360.github.io/info/">About</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="https://moni360.github.io/blog/">Blog</a> <ul class="dropdown"> <li><a href="https://moni360.github.io/blog/">Blog</a></li> <li><a href="https://moni360.github.io/blog/archive/">Blog Archive</a></li> </ul> </li> <li class="divider"></li> </ul> <ul class="right"> <li class="divider"></li> <li class="has-dropdown"> <a href="https://moni360.github.io/">Services</a> <ul class="dropdown"> <li><a href="https://moni360.github.io/feed.xml">RSS</a></li> <li><a href="https://moni360.github.io/sitemap.xml">Sitemap</a></li> </ul> </li> <li class="divider"></li> <li><a href="https://moni360.github.io/search/">Search</a></li> </ul> </section> </nav> </div><!-- /#navigation --> <div id="masthead-no-image-header"> <div class="row"> <div class="small-2 columns"></div> <div class="small-10 columns"> <a id="logo" href="https://moni360.github.io" title="Moni blog – 予告されない開発の記録"> <img src="https://moni360.github.io/assets/img/logo.png" alt="Moni blog – 予告されない開発の記録"> </a> </div><!-- /.small-12.columns --> </div><!-- /.row --> </div><!-- /#masthead --> <nav class="breadcrumbs" role="menubar" aria-label="breadcrumbs"> <li><a href="https://moni360.github.io">Home</a></li> <li><a href="https://moni360.github.io/blog/"> blog </a> <li><a href="https://moni360.github.io/blog/2015/08/"> 2015/08 </a> <li class="current">仕事でよく使うWindowsバッチファイルのあれこれ</li> </nav> <div class="row t30"> <div class="medium-8 columns"> <article itemscope itemtype="http://schema.org/Article"> <header> <span itemprop="name"> <h1>仕事でよく使うWindowsバッチファイルのあれこれ</h1> </span> </header> <p class="teaser" itemprop="description"> 怪しい記事ではありません。よく使うバッチの書き方など。 </p> <span itemprop="articleSection"> <hr> <p>お盆休みです。<br> 仕事のトラブル？みんな忘れてしまえ〜☆（ゝω・）vｷｬﾋﾟ<br> 暑さが続き、朦朧とした頭の周りを、甘い言葉を囁く妖精が飛び回る夕暮れ。</p> <p>そろそろ買い物にでも行こうと思うのですが、そんな私のココロとは正反対に、火照ったカラダは冷房を求め、繰り返す快楽の波に溺れるうちに、私は堕落させられていくのです。ハァハァ。 </p> <p>さて、、、買い物に行く前に、今回は、仕事でよく使うバッチファイルのコマンドや書き方等を自分用にまとめたいと思います。 </p> <hr> <h3>バッチファイルのあるディレクトリに移動する</h3> <p>例えば、バッチファイルとexeを合わせて配布し、バッチファイルはそのexeを呼び出すものとします。<br> バッチ内にフルパスでexeの場所を書いてしまうと、バッチとexeの置く場所を変更した場合に悲しいことが起きてしまいます。<br> フルパスで書くなんて、そんなはしたないことしませんわ、とお思いの方もいるかもしれませんが、けっこう「このディレクトリにおいてください」というバッチを見るんです。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">rem exeのある場所に移動!!
cd /d C:\hogehoge\fugafuga
piyopiyo.exe
</code></pre></div> <p>バッチの最初で、下記のように書くと、バッチのあるディレクトリに移動してくれるので、後は相対パスで記述すればOKです。</p> <div class="highlight"><pre><code class="language-text" data-lang="text">cd /d %~dp0
</code></pre></div> <p>/d はドライブ間の移動があるときのオプションですね。<br> %~dp0は、いつもよくわからないまま使っていましたが、バッチのフルパスを表す%0の引数にオプションをつけたものだそうです。<br> 何とも奇怪ですね。 </p> <p>~は引用句(&quot;)の削除を表し、dはドライブ名、pはパス名を表すので、%0からファイル名と拡張子を除いたものになるということです。<br> ちなみに、nがファイル名、xが拡張子を表します。<br> ここまでをまとめたのが、以下の表です。</p> <table> <caption>引数に使用されるオプション</caption> <colgroup> </colgroup> <thead> <tr> <th>オプション</th> <th>意味</th> </tr> </thead> <tbody> <tr> <td>%n (n:0~9)</td> <td>引数が入る特殊な変数。Cで言うargv[n]のようなもの。スペース等が入っていることもあるので引用句(")で囲まれている。</td> </tr> <tr> <td>~</td> <td>引用句(")を削除する。</td> </tr> <tr> <td>d</td> <td>ドライブ名だけ抽出。</td> </tr> <tr> <td>p</td> <td>パス名だけ抽出。</td> </tr> <tr> <td>n</td> <td>ファイル名だけ抽出。</td> </tr> <tr> <td>x</td> <td>拡張子だけ抽出。</td> </tr> </table> <hr> <h3>コマンドを非表示にする</h3> <p>コマンドプロンプトに、表示させたい文字列以外が表示されてしまうと、見にくいし、カッコ悪いです。<br> 下記のようにすると、以降のコマンドはコマンドプロンプトに表示されなくなります。</p> <div class="highlight"><pre><code class="language-text" data-lang="text">@echo off
</code></pre></div> <p>@をコマンドの頭につけるとそのコマンドは非表示になります。<br> また、echo offをつけると、それ以降のコマンドは非表示になります。<br> 単にecho offとだけ記述すると、それ以降は非表示になりますが、echo offというコマンドは表示されてしまうので、@をつけてそれ自体も表示されないようにします。 </p> <hr> <h3>ループ処理</h3> <p>for文等もあるのですが、私はいつもラベルとgotoを使用しています。<br> 下記は何かの処理を100回実行する例です。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">set /a i=0
set /a max=100

:loop_start
    if %i% gtr %max% goto loop_end
    rem 何かの処理
    set /a i+=1
    goto loop_start
:loop_end
exit
</code></pre></div> <p>ついでに、バッチの比較演算子をまとめておきましょう。<br> 数値の比較は以下の演算子で行います。 </p> <table> <caption>数値比較演算子</caption> <colgroup> </colgroup> <thead> <tr> <th>演算子</th> <th>意味</th> </tr> </thead> <tbody> <tr> <td>equ</td> <td>等しい</td> </tr> <tr> <td>neq</td> <td>等しくない</td> </tr> <tr> <td>lss</td> <td>より小さい( < )</td> </tr> <tr> <td>leq</td> <td>以下( <= )</td> </tr> <tr> <td>gtr</td> <td>より大きい( > )</td> </tr> <tr> <td>geq</td> <td>以上( >= )</td> </tr> </table> <hr> <h3>ディレクトリを作成する</h3> <p>ディレクトリを作成するときに、同名のディレクトリが存在するか確認してから作成します。<br> existを使います。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">set dirname=test
if not exist %dirname% (mkdir %dirname%)
</code></pre></div> <hr> <h3>実行したコマンドの結果を取得する</h3> <p>実行したコマンドの結果を参照して、処理を分岐させたいことなどがあると思います。 簡単そうですが、バッチではなかなか複雑で、忘れがちです。<br> 結果から書くと、下記のように記述します。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">set result=
for /f %%i in (&#39;hogehoge.exe&#39;) do set result=%%i
</code></pre></div> <p>/fオプションはfor文でファイル解析を行うオプションです。<br> for文でシングルクォート(&#39;)で囲まれたコマンドを実行した結果をiに格納します。<br> そして、doで変数resultに代入しています。 </p> <p>この結果をif等で利用すれば、コマンドの結果により、処理を切り替えられます。<br> 私の場合は、何らかの期待値と比較するexeを作成して、例えば、以下のように、結果をパイプでfindに渡し、&quot;ERROR&quot;という文字列が含まれるかどうかを調べます。<br> resultが空のままであればOK、何か入っていればNGとなります。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">set result=
for /f %%i in (&#39;hogehoge.exe ^| find &quot;ERROR&quot;&#39;) do set result=%%i
if &quot;result&quot;==&quot;&quot; (
    echo OKの処理
) else (
    echo NGの処理
)
</code></pre></div> <p>また、下記のように、&quot;usebackq&quot;オプションを使用すれば、コマンドをバッククォート(`)で囲むこともできます。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">set result=
for /f &quot;usebackq&quot; %%i in (`hogehoge.exe`) do set result=%%i
</code></pre></div> <hr> <h3>指定した秒数待つ</h3> <p>timeoutを使います。引数で指定した秒数、処理を停止します。</p> <div class="highlight"><pre><code class="language-text" data-lang="text">timeout 100
</code></pre></div> <p>実行すると、残りの時間が表示されるのですが、何も表示させたくない場合は下記のようにnulデバイスにリダイレクトします。<br> <code> timeout 100 &gt; nul </code></p> <hr> <h3>シャットダウンする</h3> <p>shutdownを使います。 </p> <p>以下のように書くと、直ちにシャットダウンが開始されます。</p> <div class="highlight"><pre><code class="language-text" data-lang="text">shutdown -s -t 0
</code></pre></div> <p>シャットダウンをする時間を遅らせたい場合は、-tの後の0を変更します。単位は秒です。 </p> <p>リブートする場合は、-sを-rに変えます。</p> <div class="highlight"><pre><code class="language-text" data-lang="text">shutdown -r -t 0
</code></pre></div> <hr> <h3>バッチから別のバッチを実行する（同一ウィンドウ）</h3> <p>callを使います。<br> callを使用しないで、<code>hogehoge.bat</code>とだけ記述すると、そこで呼び出し元のバッチファイルの処理が終了してしまいます。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">call hogehoge.bat
</code></pre></div> <hr> <h3>バッチから別のバッチを実行する（別ウィンドウ）</h3> <p>startを使います。<br> 新しいウィンドウが開き、呼び出したバッチの処理は、そこで実行されます。<br> 並列処理をさせたい場合に便利。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">start hogehoge.bat
</code></pre></div> <p>新しいウィンドウを表示させたくない（バックグラウンドでの処理としたい）場合、/bオプションをつけます。 </p> <div class="highlight"><pre><code class="language-text" data-lang="text">start /b hogehoge.bat
</code></pre></div> <p>ただし、バックグラウンドで開始させてしまうと、終了にはタスクマネージャー等でプロセスを終了させるしかなくなります。 </p> <hr> <p>さて、だいたいこんなところでしょうか。<br> また思い出したら随時書き足していきたいと思います。<br> 最近はpowershellなんてものもあるので、複雑な処理が書きたかったらそっちでやった方がカンタンですね。<br> それでは、買い物に行ってきます。 </p> </span> <div id="page-meta" class="t30"> <p> <!-- Look the author details up from the site config. --> <!-- Output author details if some exist. --> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="pr20 icon-edit"><a href="https://github.com/moni360" target="_blank"> Moni</a></span> </span> <time class="icon-calendar pr20" datetime="2015-08-16" itemprop="datePublished"> <a href="https://moni360.github.io/blog/2015/08"> 2015-08-16 </a> </time> <span class="icon-archive pr20"> <a href="https://moni360.github.io/blog/category/18禁"> 18禁 </a> </span> <br> <span class="pr20"><span class="icon-price-tag pr10"> <a href="https://moni360.github.io/blog/tag/Windows">Windows</a> </span><span class="icon-price-tag pr10"> <a href="https://moni360.github.io/blog/tag/bat">bat</a> </span><span class="icon-price-tag pr10"> <a href="https://moni360.github.io/blog/tag/自動化">自動化</a> </span></span> </p> <div id="post-nav" class="row"> <div class="small-5 columns"><a class="button small radius prev" href="https://moni360.github.io/blog/2015/08/studying-pandas-1/">&laquo; Pandasで...</a></div><!-- /.small-4.columns --> <div class="small-5 columns text-right"><a class="button small radius next" href="https://moni360.github.io/blog/2015/08/windows-bat-date-and-time/">バッチで日付と... &raquo;</a></div><!-- /.small-4.columns --> </div> </div><!-- /.page-meta --> <h3 id="comments" class="t60">Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */ var disqus_shortname = 'moni360'; var disqus_identifier = '/blog/2015/08/windows-bat-memo/'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </article> </div><!-- /.medium-8.columns --> <div class="medium-4 columns"> <aside> <div class="panel radius"> <h3>新しい記事</h3> <a href="https://moni360.github.io/blog/2015/08/windows-bat-date-and-time/" title="バッチで日付と時刻を取得するを読む"><strong>バッチで日付と時刻を取得する</strong></a> 2015-08-20<br /> <a href="https://moni360.github.io/blog/2015/08/studying-pandas-1/" title="Pandasで何かに白黒つけたいを読む"><strong>Pandasで何かに白黒つけたい</strong></a> 2015-08-01<br /> <a href="https://moni360.github.io/blog/2015/07/customize-blog/" title="Blogをカスタマイズするを読む"><strong>Blogをカスタマイズする</strong></a> 2015-07-23<br /> <a href="https://moni360.github.io/blog/2015/07/first-post/" title="初めての投稿を読む"><strong>初めての投稿</strong></a> 2015-07-19<br /> </div> <div class="panel radius"> <h3>関連する記事</h3> <a href="/blog/2015/08/windows-bat-date-and-time/"><strong>バッチで日付と時刻を取得する</strong></a><br /> </div> <h3>Tag Cloud</h3> <span class="site-tag"> <a href="/blog/tag/Windows/" style="font-size: 108%"> Windows (2) </a> </span> <span class="site-tag"> <a href="/blog/tag/bat/" style="font-size: 108%"> bat (2) </a> </span> <span class="site-tag"> <a href="/blog/tag/pandas/" style="font-size: 94%"> pandas (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/python/" style="font-size: 94%"> python (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/テスト/" style="font-size: 94%"> テスト (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/データ分析/" style="font-size: 94%"> データ分析 (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/プロ野球/" style="font-size: 94%"> プロ野球 (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/日記/" style="font-size: 94%"> 日記 (1) </a> </span> <span class="site-tag"> <a href="/blog/tag/自動化/" style="font-size: 108%"> 自動化 (2) </a> </span> </aside> </div><!-- /.medium-4.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>Copyright (c) 2015 Moni, All Rights Reserved.</li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://github.com/moni360" target="_blank" class="icon-github" title="作ったコードなど"></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="https://moni360.github.io/assets/js/javascript.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-65303984-1', 'auto'); ga('set', 'anonymizeIp', true); ga('send', 'pageview'); </script> </body> </html>
